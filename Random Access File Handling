#include <stdio.h>
#include <stdlib.h>

struct Employee {
    int id;
    char name[20];
    float salary;
};

int main() {
    FILE *fp;
    struct Employee emp;
    int choice, id, found;

    fp = fopen("employee.dat", "rb+");  
    if (fp == NULL) {
        fp = fopen("employee.dat", "wb+");  
        if (fp == NULL) {
            printf("Error opening file!\n");
            return 1;
        }
    }

    while (1) {
        printf("\n--- Employee Record System (Random Access File) ---\n");
        printf("1. Add Employee\n");
        printf("2. Display All Employees\n");
        printf("3. Search Employee by ID\n");
        printf("4. Update Employee by ID\n");
        printf("5. Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        switch (choice) {
        case 1: 
            printf("Enter ID, Name, Salary: ");
            scanf("%d %s %f", &emp.id, emp.name, &emp.salary);
            fseek(fp, 0, SEEK_END);  // move to end
            fwrite(&emp, sizeof(emp), 1, fp);
            printf("Employee added successfully.\n");
            break;

        case 2:
            rewind(fp);
            printf("\nID\tName\tSalary\n");
            while (fread(&emp, sizeof(emp), 1, fp)) {
                printf("%d\t%s\t%.2f\n", emp.id, emp.name, emp.salary);
            }
            break;

        case 3: 
            printf("Enter employee ID to search: ");
            scanf("%d", &id);
            rewind(fp);
            found = 0;
            while (fread(&emp, sizeof(emp), 1, fp)) {
                if (emp.id == id) {
                    printf("Employee Found: %d %s %.2f\n", emp.id, emp.name, emp.salary);
                    found = 1;
                    break;
                }
            }
            if (!found) printf("Employee not found!\n");
            break;

        case 4: 
            printf("Enter employee ID to update: ");
            scanf("%d", &id);
            rewind(fp);
            found = 0;
            while (fread(&emp, sizeof(emp), 1, fp)) {
                if (emp.id == id) {
                    printf("Enter new Name and Salary: ");
                    scanf("%s %f", emp.name, &emp.salary);
                    fseek(fp, -sizeof(emp), SEEK_CUR);  // move pointer back
                    fwrite(&emp, sizeof(emp), 1, fp);
                    printf("Employee updated successfully.\n");
                    found = 1;
                    break;
                }
            }
            if (!found) printf("Employee not found!\n");
            break;

        case 5: 
            fclose(fp);
            exit(0);

        default:
            printf("Invalid choice!\n");
        }
    }

    return 0;
}
